let purchaseDetail=[],purchaseForm=!1;function initPurchaseDetail(){return!(!lsTest()||!ADD_PURCHASE_PAGE)&&("string"!=typeof(purchaseDetail=localStorage.getItem(LS_PURCHASE_NAME))?(purchaseDetail=[],!0):(purchaseDetail=JSON.parse(purchaseDetail),initPurchaseDetailTable(),!0))}function initPurchaseDetailTable(){let e=0,t=0;if($("#purchase-detail-table").addClass("d-none"),$(".btn-block").attr("disabled",!0),purchaseForm=!1,purchaseDetail.length<1)return!0;$("#purchase-detail-table").removeClass("d-none"),$("#purchase-detail-table tbody").empty(),$.each(purchaseDetail,(a,r)=>{e+=parseInt(r.product_price),t+=parseInt(r.product_quantity),$("#purchase-detail-table tbody").append(`\n      <tr class="text-center" \n        data-id="${r.product_id}">\n        <td class="align-middle">${a+1}</td>\n        <td class="align-middle purchase-product-name" width="200">${r.product_name}</td>\n        <td class="align-middle">\n            <input type="hidden"\n              value="${r.product_id}"\n              name="purchase_detail[${a}][product_id]"\n              class="purchase-product-id" />\n              <div class="d-flex mx-auto justify-content-center" style="width: 50px">\n                <input type="text" \n                  class="form-control mx-auto w-100 text-center py-0 purchase-product-qty" \n                  value="${r.product_quantity}" \n                  data-id="${r.product_id}"\n                  name="purchase_detail[${a}][quantity]">\n              </div>\n        </td>\n        <td class="align-middle">\n          <div class="d-flex mx-auto justify-content-center" style="width: 125px">\n            <input type="text" \n              class="form-control mx-auto w-100 py-0 purchase-product-price text-center" \n              value="${r.product_price}" \n              data-id="${r.product_id}"\n              name="purchase_detail[${a}][total]">\n          </div>\n        </td>\n        <td class="align-middle">\n            <button type="button" \n              class="btn btn-sm btn-danger purchase-product-delete"\n              title="Hapus"\n              data-id="${r.product_id}">\n                <i class="fas fa-times"></i>\n            </button>\n        </td>\n      </tr>\n    `)}),$("#add-purchase-total-text").text(`Rp${formatRupiah(e)}`),$('input[name="purchase[total]"]').val(e),$('input[name="purchase[quantity]"]').val(t),$(".btn-block").attr("disabled",!1),purchaseForm=!0}function inputPurchaseProductDetailChange(){let e=$("#purchase-detail-table").find(".purchase-product-name"),t=$("#purchase-detail-table").find(".purchase-product-id"),a=$("#purchase-detail-table").find(".purchase-product-qty"),r=$("#purchase-detail-table").find(".purchase-product-price");$.each(purchaseDetail,(c,i)=>{purchaseDetail[c].product_id=t.eq(c).val(),purchaseDetail[c].product_name=e.eq(c).text(),purchaseDetail[c].product_quantity=a.eq(c).val(),purchaseDetail[c].product_price=r.eq(c).val()}),resetLsPurchaseDetail(),initPurchaseDetailTable()}function addPurchaseDetail(){if(parseFloat(getLsSize().total)>4500)return $("#ls-over").removeClass("d-none"),!0;$("#ls-over").addClass("d-none");let e=getPurchaseAddFormValue();purchaseDetail.length>0?updatePurchaseDetail(e):purchaseDetail.push(e),resetLsPurchaseDetail(),initPurchaseDetailTable()}function resetLsPurchaseDetail(){localStorage.removeItem(LS_PURCHASE_NAME),localStorage.setItem(LS_PURCHASE_NAME,JSON.stringify(purchaseDetail))}function updatePurchaseDetail(e){let t=!1;$.each(purchaseDetail,(a,r)=>{r.product_id===e.product_id&&(purchaseDetail[a].product_quantity=parseInt(e.product_quantity)+parseInt(purchaseDetail[a].product_quantity),purchaseDetail[a].product_price=parseInt(e.product_price)+parseInt(purchaseDetail[a].product_price),t=!0)}),t||purchaseDetail.push(e)}function getPurchaseAddFormValue(){return{product_id:$("#purchase-product-form").find(".select2bs4").children("option:selected").val(),product_price:$("#purchase-product-form").find(".select2bs4").children("option:selected").attr("data-price"),product_name:$("#purchase-product-form").find(".select2bs4").children("option:selected").attr("data-name"),product_quantity:$("#purchase-product-form").find(".text-center").val()}}function deletePurchaseDetail(e){$.each(purchaseDetail,(t,a)=>{a.product_id===e.attr("data-id")&&purchaseDetail.splice(t,1)}),resetLsPurchaseDetail(),initPurchaseDetailTable()}function deleteAllPurchaseDetail(){purchaseDetail=[],resetLsPurchaseDetail(),initPurchaseDetailTable()}function destroyPurchaseDetailTable(){$("purchase-detail-table").addClass("d-none")}$(document).ready(()=>{lsTest()||$("#ls-alert").removeClass("d-none");const e=initPurchaseDetail();$("#purchase-product-form").submit(function(t){t.preventDefault(),e&&addPurchaseDetail()}),$("#purchase-detail-table").on("click",".purchase-product-delete",function(t){t.preventDefault(),e&&deletePurchaseDetail($(this))}),$("#purchase-detail-table").on("click","#delete-all-purchases",function(t){t.preventDefault(),e&&deleteAllPurchaseDetail()}),$("#purchase-detail-table").on("change",".purchase-product-qty",function(t){e&&(parseInt($(this).val())<1||""===$(this).val()||isNaN(parseInt($(this).val()))?$(this).val("1"):$(this).val(parseInt($(this).val())),inputPurchaseProductDetailChange())}),$("#purchase-detail-table").on("change",".purchase-product-price",function(t){e&&(parseInt($(this).val())<0||""===$(this).val()||isNaN(parseInt($(this).val()))?$(this).val("0"):$(this).val(parseInt($(this).val())),inputPurchaseProductDetailChange())}),$("#add-purchase-form").submit(function(e){purchaseForm||e.preventDefault()})});
