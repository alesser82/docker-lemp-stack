let orderDetail=[],orderForm=!1;function initOrderDetail(){return!(!lsTest()||!ADD_ORDER_PAGE)&&("string"!=typeof(orderDetail=localStorage.getItem(LS_ORDER_NAME))?(orderDetail=[],!0):(orderDetail=JSON.parse(orderDetail),initOrderDetailTable(),!0))}function initOrderDetailTable(){let e=0,t=0;if($("#order-detail-table").addClass("d-none"),$(".btn-block").attr("disabled",!0),orderForm=!1,orderDetail.length<1)return!0;$("#order-detail-table").removeClass("d-none"),$("#order-detail-table tbody").empty(),$.each(orderDetail,(r,d)=>{e+=parseInt(d.product_price),t+=parseInt(d.product_quantity),$("#order-detail-table tbody").append(`\n      <tr class="text-center" \n        data-id="${d.product_id}">\n        <td class="align-middle">${r+1}</td>\n        <td class="align-middle order-product-name" width="200">${d.product_name}</td>\n        <td class="align-middle">\n            <input type="hidden"\n              value="${d.product_id}"\n              name="order_detail[${r}][product_id]"\n              class="order-product-id" />\n              <div class="d-flex mx-auto justify-content-center" style="width: 50px">\n                <input type="text" \n                  class="form-control mx-auto w-100 text-center py-0 order-product-qty" \n                  value="${d.product_quantity}" \n                  data-id="${d.product_id}"\n                  name="order_detail[${r}][quantity]">\n              </div>\n        </td>\n        <td class="align-middle">\n          <div class="d-flex mx-auto justify-content-center" style="width: 125px">\n            <input type="text" \n              class="form-control mx-auto w-100 py-0 order-product-price text-center" \n              value="${d.product_price}" \n              data-id="${d.product_id}"\n              name="order_detail[${r}][total]">\n          </div>\n        </td>\n        <td class="align-middle">\n            <button type="button" \n              class="btn btn-sm btn-danger order-product-delete"\n              title="Hapus"\n              data-id="${d.product_id}">\n                <i class="fas fa-times"></i>\n            </button>\n        </td>\n      </tr>\n    `)}),$("#add-order-total-text").text(`Rp${formatRupiah(e)}`),$('input[name="order[total]"]').val(e),$('input[name="order[quantity]"]').val(t),$(".btn-block").attr("disabled",!1),orderForm=!0}function inputOrderProductDetailChange(){let e=$("#order-detail-table").find(".order-product-name"),t=$("#order-detail-table").find(".order-product-id"),r=$("#order-detail-table").find(".order-product-qty"),d=$("#order-detail-table").find(".order-product-price");$.each(orderDetail,(a,i)=>{orderDetail[a].product_id=t.eq(a).val(),orderDetail[a].product_name=e.eq(a).text(),orderDetail[a].product_quantity=r.eq(a).val(),orderDetail[a].product_price=d.eq(a).val()}),resetLsOrderDetail(),initOrderDetailTable()}function addOrderDetail(){if(parseFloat(getLsSize().total)>4500)return $("#ls-over").removeClass("d-none"),!0;$("#ls-over").addClass("d-none");let e=getOrderAddFormValue();if(parseInt(e.product_stock)<parseInt(e.product_quantity))return $("#ls-over").removeClass("d-none"),!1;orderDetail.length>0?updateOrderDetail(e):orderDetail.push(e),resetLsOrderDetail(),initOrderDetailTable()}function resetLsOrderDetail(){localStorage.removeItem(LS_ORDER_NAME),localStorage.setItem(LS_ORDER_NAME,JSON.stringify(orderDetail))}function updateOrderDetail(e){let t=!1;$.each(orderDetail,(r,d)=>{d.product_id===e.product_id&&(orderDetail[r].product_quantity=parseInt(e.product_quantity)+parseInt(orderDetail[r].product_quantity),orderDetail[r].product_price=parseInt(e.product_price)+parseInt(orderDetail[r].product_price),t=!0)}),t||orderDetail.push(e)}function getOrderAddFormValue(){return{product_id:$("#order-product-form").find(".select2bs4").children("option:selected").val(),product_price:$("#order-product-form").find(".select2bs4").children("option:selected").attr("data-price"),product_name:$("#order-product-form").find(".select2bs4").children("option:selected").attr("data-name"),product_stock:$("#order-product-form").find(".select2bs4").children("option:selected").attr("data-stock"),product_quantity:$("#order-product-form").find(".text-center").val()}}function deleteOrderDetail(e){$.each(orderDetail,(t,r)=>{r.product_id===e.attr("data-id")&&orderDetail.splice(t,1)}),resetLsOrderDetail(),initOrderDetailTable()}function deleteAllOrderDetail(){orderDetail=[],resetLsOrderDetail(),initOrderDetailTable()}function destroyOrderDetailTable(){$("order-detail-table").addClass("d-none")}$(document).ready(()=>{lsTest()||$("#ls-alert").removeClass("d-none");const e=initOrderDetail();$("#order-product-form").submit(function(t){t.preventDefault(),e&&addOrderDetail()}),$("#order-detail-table").on("click",".order-product-delete",function(t){t.preventDefault(),e&&deleteOrderDetail($(this))}),$("#order-detail-table").on("click","#delete-all-orders",function(t){t.preventDefault(),e&&deleteAllOrderDetail()}),$("#order-detail-table").on("change",".order-product-qty",function(t){e&&(parseInt($(this).val())<1||""===$(this).val()||isNaN(parseInt($(this).val()))?$(this).val("1"):$(this).val(parseInt($(this).val())),inputOrderProductDetailChange())}),$("#order-detail-table").on("change",".order-product-price",function(t){e&&(parseInt($(this).val())<0||""===$(this).val()||isNaN(parseInt($(this).val()))?$(this).val("0"):$(this).val(parseInt($(this).val())),inputOrderProductDetailChange())}),$("#add-order-form").submit(function(e){orderForm||e.preventDefault()})});
